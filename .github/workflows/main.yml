# Code generated by Jsonnet. DO NOT EDIT
# DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
jobs:
  build_and_push:
    name: docker build and push
    needs:
      - hadolint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: docker/build-push-action@v1
        with:
          password: ${{ secrets.DOCKER_PASSWORD }}
          repository: cakehappens/realworld-kubernetes-gitops
          tags: ${{ github.sha }}
          username: ${{ secrets.DOCKER_USERNAME }}
  deploy:
    name: deploy
    needs:
      - name: render manifests
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v2
          - uses: ./.github/actions/jsonnet
            with:
              args: jsonnet --help
    runs-on: ubuntu-latest
    steps:
      - env:
          KUBECTL_VERSION: "1.14"
          KUBE_CONFIG_DATA: ${{ secrets.KUBE_CONFIG_DATA }}
        uses: steebchen/kubectl@master
        with:
          args: version
  hadolint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: brpaz/hadolint-action@master
  render_manifests:
    name: render manifests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: ./.github/actions/jsonnet
        with:
          args: jsonnet --help
name: main
on:
  push:
    branches:
      - main
    paths-ignore:
      - docs/**
      - scripts/**
      - jsonnetfile.*
      - Makefile
      - README.md
      - .github/workflows/**
      - '!.github/workflows/main.yml'
